<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pablo Reyes">

<title>Taller 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Taller2_Md_files/libs/clipboard/clipboard.min.js"></script>
<script src="Taller2_Md_files/libs/quarto-html/quarto.js"></script>
<script src="Taller2_Md_files/libs/quarto-html/popper.min.js"></script>
<script src="Taller2_Md_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Taller2_Md_files/libs/quarto-html/anchor.min.js"></script>
<link href="Taller2_Md_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Taller2_Md_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Taller2_Md_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Taller2_Md_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Taller2_Md_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Taller 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pablo Reyes </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduccion" class="level1">
<h1>Introduccion</h1>
<section id="problema" class="level3">
<h3 class="anchored" data-anchor-id="problema">Problema</h3>
<p>Para acceder a los datos de las dos redes de estaciones, se realiza mediante una API (interfaz de programación de aplicaciones). Así, mediante programación (ej., paquete de R) es posible descargar los datos. En algunos casos el uso de las API permite la obtención de datos bien estructurados, sin embargo, no siempre sucede así. En este caso trabajaremos con dos escenarios:</p>
<p>datos estructurados obtenidos mediante API (agrometR) datos desordenados obtenidos con diferentes estructuras (API AGV privada) El objetivo de los talleres del curso es poder importar, ordenar, transformar, visualizar y modelar estos dos set de datos. ## Librerias</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
</section>
<section id="cargar-los-datos" class="level3">
<h3 class="anchored" data-anchor-id="cargar-los-datos">Cargar los datos</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>agroAPI <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/data_estaciones_agrometAPI.rds"</span>) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>meta_agro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/metadata_estaciones_agrometAPI.rds"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Mascaras </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mascara_agromet <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/station_id_agromet_Pablo.rds"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>mascara_agv <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/station_id_agv_Pablo.rds"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Mascaras</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Sets de datos</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>agv_meta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/metadata_estaciones_agvAPI(1).rds"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>api_agv <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"C:/Rmdtos/data_raw/data_agvAPI.rds"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Aplicación de máscaras</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>agv_meta <span class="ot">&lt;-</span> agv_meta[agv_meta<span class="sc">$</span>serial <span class="sc">%in%</span> mascara_agv,]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>api_agv_rows <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(agv_meta[agv_meta<span class="sc">$</span>serial <span class="sc">%in%</span> mascara_agv,]))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>api_agv_rows <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(agv_meta[agv_meta<span class="sc">$</span>tipo <span class="sc">==</span> <span class="st">"Humedad_Suelo"</span>,]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introducidos por coerción</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>api_agv_rows <span class="ot">&lt;-</span> api_agv_rows[<span class="sc">!</span><span class="fu">is.na</span>(api_agv_rows)]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> api_agv[<span class="fu">c</span>(api_agv_rows)]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Filtros</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#145 filas estaciones </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#cantidad de variables</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data,ncol)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data,nrow)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># varibles unicas </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>vars_un<span class="ot">&lt;-</span> <span class="fu">unique</span>(vars)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>ind785 <span class="ot">&lt;-</span> vars<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">5</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>data785 <span class="ot">&lt;-</span> data[ind785]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># los indicadores de las estaciones que tienen 7 variables</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>serial_est<span class="ot">&lt;-</span> agv_meta<span class="sc">$</span>serial[ind785]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="utilizando-r-base-readr-tidyr-y-lo-visto-de-dplyr-debe-extraer-los-datos-de-humedad-de-suelo-a-tres-profundidades-30cm-60cm-y-90cm-desde-el-set-de-datos-data_agvapi.rds-y-utilizar-el-set-de-datos-metadata_estaciones_agvapi.rds-para-extaer-la-información-necesaria-de-las-estaciones.-debe-realizarlo-con-todas-las-estaciones-asignadas-a-usted.-debe-crear-un-set-de-datos-tidy-ej-tibble-que-tenga-las-columnas-de-serial-profundidad-fecha_hora-valor.-este-set-de-datos-debe-contener-los-datos-de-humedad-de-suelo-de-todas-las-estaciones-agv-asignadas-a-usted." class="level4">
<h4 class="anchored" data-anchor-id="utilizando-r-base-readr-tidyr-y-lo-visto-de-dplyr-debe-extraer-los-datos-de-humedad-de-suelo-a-tres-profundidades-30cm-60cm-y-90cm-desde-el-set-de-datos-data_agvapi.rds-y-utilizar-el-set-de-datos-metadata_estaciones_agvapi.rds-para-extaer-la-información-necesaria-de-las-estaciones.-debe-realizarlo-con-todas-las-estaciones-asignadas-a-usted.-debe-crear-un-set-de-datos-tidy-ej-tibble-que-tenga-las-columnas-de-serial-profundidad-fecha_hora-valor.-este-set-de-datos-debe-contener-los-datos-de-humedad-de-suelo-de-todas-las-estaciones-agv-asignadas-a-usted.">Utilizando R-base, readr, tidyr y lo visto de {dplyr} Debe extraer los datos de humedad de suelo a tres profundidades (30cm, 60cm y 90cm) desde el set de datos data_agvAPI.rds y utilizar el set de datos metadata_estaciones_agvAPI.rds para extaer la información necesaria de las estaciones. Debe realizarlo con todas las estaciones asignadas a usted. Debe crear un set de datos tidy (ej, tibble) que tenga las columnas de: serial, profundidad, fecha_hora, valor. Este set de datos debe contener los datos de humedad de suelo de todas las estaciones AGV asignadas a usted.</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,429 × 4
   Fecha_Hora       valores profundidad serial  
   &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;   
 1 2022-09-01 00:00    31.9          90 z6-08721
 2 2022-09-01 01:00    31.9          90 z6-08721
 3 2022-09-01 02:00    31.9          90 z6-08721
 4 2022-09-01 03:00    31.9          90 z6-08721
 5 2022-09-01 04:00    31.9          90 z6-08721
 6 2022-09-01 05:00    31.9          90 z6-08721
 7 2022-09-01 06:00    31.9          90 z6-08721
 8 2022-09-01 07:00    31.9          90 z6-08721
 9 2022-09-01 08:00    31.9          90 z6-08721
10 2022-09-01 09:00    31.9          90 z6-08721
# … with 9,419 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="el-set-de-datos-obtenido-en-el-punto-anterior-lo-debe-ordenar-de-mayor-a-menor-utilizando-la-función-dplyrarrange." class="level3">
<h3 class="anchored" data-anchor-id="el-set-de-datos-obtenido-en-el-punto-anterior-lo-debe-ordenar-de-mayor-a-menor-utilizando-la-función-dplyrarrange.">El set de datos obtenido en el punto anterior lo debe ordenar de mayor a menor utilizando la función dplyr::arrange.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mam <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(data_final,<span class="fu">desc</span>(valores))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="utilice-la-función-tidyrseparate-para-crear-una-columna-de-fecha-y-otra-de-hora-a-partir-de-la-columnas-fecha_hora." class="level3">
<h3 class="anchored" data-anchor-id="utilice-la-función-tidyrseparate-para-crear-una-columna-de-fecha-y-otra-de-hora-a-partir-de-la-columnas-fecha_hora.">Utilice la función tidyr::separate para crear una columna de fecha y otra de hora, a partir de la columnas fecha_hora.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Fecha'</span>, <span class="st">'Hora'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fecha_hora <span class="ot">&lt;-</span> <span class="fu">separate</span>(data_final,<span class="st">'Fecha_Hora'</span>,h,<span class="at">sep=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>